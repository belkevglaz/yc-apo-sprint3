# 3. Архитектурный обзор

## 3.1. **Общая архитектура**  
---
Описание общей структуры системы. Можно использовать диаграммы, например, C4-диаграммы, UML или блок-схемы, чтобы
показать основные компоненты и их взаимодействия.
---

Система состоит из нескольких компонент, обеспечивающих получение данных с датчиков (телеметрия), хранение этих данных, обработку, 
обеспечение авторизованного доступа к данных и организацию возможности автоматизации на основе имеющихся данных.

Функционально система делится на несколько доменных областей: 


* Домен управления локациями/пользователями 
  * Поддомен регистрации, аутентификации и авторизации пользователей
    * Контекст: регистрация и вход пользователя
    * Контекст: управление профилем пользователя
  * Поддомен поселками и домами
    * Контекст: управление поселками
    * Контекст: управление домами

---

* Домен телеметрии
  - Поддомен истории и отчетов
    * Контекст: Предоставление истории по данным телеметрии и отчетов
  - Поддомен управления данными телеметрии
    * Контекст: сбор данных телеметрии
    * Контекст: трансформация данных телеметрии 
    * Контекст: хранение данных 
---

* Домен управления устройствами
  - Поддомен управления устройствами
    * Контекст: регистрация новых устройств
    * Контекст: управление существующими устройства
  - Поддомен запуска сценариев
     * Контекст: создание и редактирование сценариев
     * Контекст: запуск сценариев по событию
     * Контекст: запуск сценариев по расписанию

---

Разбиение на домены отображено на диаграмме стратегического проектирования   

[//]: # (<details>)
[//]: # (  <summary>Strategic Diagram</summary>)
{% include 'assets/target/StrategicDesign.md' %}

[//]: # (</details>)

## 3.2. **Стили и паттерны архитектуры**

Микросервисная архитектура подразумевает, что приложение разделено на множество отдельных сервисов, 
каждый из которых выполняет свою уникальную задачу и может быть развернут, 
обновлен и масштабирован независимо от других. Такая архитектура позволяет повысить гибкость разработки, 
ускорить внедрение новых функций, а также упрощает поддержку и масштабирование системы.
 
Для реализации обработки и хранения большого объема данных будем использовать паттерн Event Sourcing. Это обеспечит 
возможность работать с потоком данных, а также хорошие возможности по масштабированию и отказоустойчивости.  

Для обеспечения безопасности, управления доступом и других функций будет использоваться паттерн API Gateway.
Он играет роль посредника между внешними клиентами и внутренними микросервисами

Для хранения данных будет использоваться реляционная СУБД.

В реальности, предполагается довольно большой поступающих данных от датчиков и всевозможных модулей. 
Поэтому для избежания конкурентных обращений на чтение и на запись, целесообразно для обработки и чтения данных телеметрии
использовать архитектурный паттерн CQRS, дабы разделить потоки чтения и записи данных телеметрии.


[//]: # (<details>)
[//]: # (  <summary>Tactical Diagram</summary>)
{% include 'assets/target/TacticalDesign.md' %}

[//]: # (</details>)

## 3.3. **Основные компоненты**

В качестве реализации Event Sourcing подхода, будет использоваться Apache Kafka — распределенная система обмена сообщениями,
которая обеспечивает надежную и высокопроизводительную передачу данных.

Среди основных преимуществ Kafka:

* Высокая производительность —
  Kafka способна обрабатывать большие объемы данных с минимальной задержкой, что делает её идеальной
  для сценариев с высокими нагрузками.
* Масштабируемость —
  Kafka легко масштабируется горизонтально, что позволяет ей справляться с увеличением числа сообщений и микросервисов.
* Устойчивость к сбоям — благодаря репликации данных, Kafka обеспечивает высокую отказоустойчивость и
  может восстанавливаться после сбоев без потери данных.


API Gateway предоставляет следующие преимущества:

* Централизованная аутентификация и авторизация — все запросы проходят через API Gateway,
  что позволяет централизованно управлять доступом к микросервисам.
* Балансировка нагрузки — распределяет входящие запросы между микросервисами для равномерного использования ресурсов.
* Безопасность — API Gateway позволяет внедрить механизмы защиты, такие как SSL/TLS шифрование,
  защита от DDoS атак и ограничение числа запросов.
* Кэширование — позволяет снижать нагрузку на микросервисы за счет кэширования часто запрашиваемых данных.
* Мониторинг и логирование — API Gateway предоставляет возможность централизованного сбора логов и метрик,
  что упрощает отслеживание производительности и выявление проблем.

PostgreSQL — это мощная, открытая реляционная СУБД, известная своей надежностью, 
расширяемостью и поддержкой сложных запросов и транзакций. 
Она обеспечивает высокую производительность, гибкие механизмы индексации и работу с большими объемами данных, 
а также поддерживает множество расширений.
 
---